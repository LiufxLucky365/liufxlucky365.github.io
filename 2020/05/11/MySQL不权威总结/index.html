<!DOCTYPE html>




<html class="theme-next gemini" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="欢迎阅读本文并非事无巨细的mysql学习资料，而是选择其中重要、困难、易错的部分进行系统地总结梳理，适合有一定mysql使用经验的同学。为了避免枯燥和一叶障目，每一块知识只进行较为抽象的总结，涉及到具体的技术细节会附上相关资料供需要时再具体研究">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL不权威总结">
<meta property="og:url" content="http://yoursite.com/2020/05/11/MySQL不权威总结/index.html">
<meta property="og:site_name" content="Liufxlucky365">
<meta property="og:description" content="欢迎阅读本文并非事无巨细的mysql学习资料，而是选择其中重要、困难、易错的部分进行系统地总结梳理，适合有一定mysql使用经验的同学。为了避免枯燥和一叶障目，每一块知识只进行较为抽象的总结，涉及到具体的技术细节会附上相关资料供需要时再具体研究">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/006QGE4bly1geub5p1v2zj307t07b3yn.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/006QGE4bly1gevhglmi32j30f305bmx8.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/006QGE4bly1gevhxhpxe4j31ak0ow4qp.jpg">
<meta property="og:image" content="http://ww1.sinaimg.cn/large/006QGE4bly1gevkjaiqmhj30ig0eujs1.jpg">
<meta property="og:updated_time" content="2020-05-24T11:20:13.061Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MySQL不权威总结">
<meta name="twitter:description" content="欢迎阅读本文并非事无巨细的mysql学习资料，而是选择其中重要、困难、易错的部分进行系统地总结梳理，适合有一定mysql使用经验的同学。为了避免枯燥和一叶障目，每一块知识只进行较为抽象的总结，涉及到具体的技术细节会附上相关资料供需要时再具体研究">
<meta name="twitter:image" content="http://ww1.sinaimg.cn/large/006QGE4bly1geub5p1v2zj307t07b3yn.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"right","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/05/11/MySQL不权威总结/"/>





  <title>MySQL不权威总结 | Liufxlucky365</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-right page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Liufxlucky365</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">211&835</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/11/MySQL不权威总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Liufxlucky365">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/default_avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Liufxlucky365">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">MySQL不权威总结</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-11T00:00:00+08:00">
                2020-05-11
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          
            <span class="post-meta-divider">|</span>
            <span id="busuanzi_value_page_pv"></span>次阅读
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="欢迎阅读"><a href="#欢迎阅读" class="headerlink" title="欢迎阅读"></a>欢迎阅读</h2><p>本文并非事无巨细的mysql学习资料，而是选择其中重要、困难、易错的部分进行系统地总结梳理，适合有一定mysql使用经验的同学。为了避免枯燥和一叶障目，每一块知识只进行较为抽象的总结，涉及到具体的技术细节会附上相关资料供需要时再具体研究</p>
<a id="more"></a>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p>mysql整体架构分为两层，服务层和存储引擎，服务层负责数据库实例的基本功能（如多线程的连接管理、权限管理、配置管理）和部分粗粒度的查询操作（如查询缓存、SQL解析与优化、部分查询结果的过滤与排序）。存储引擎负责数据存储和读取，索引、事务、锁大部分功能基本都实现在引擎层</p>
<p><img src="http://ww1.sinaimg.cn/large/006QGE4bly1geub5p1v2zj307t07b3yn.jpg" alt="mysql架构.png"></p>
<p><strong>查询缓存</strong><br>mysql的查询缓存比较鸡肋，如果两个查询在任何字符上有所不同（哪怕是注释、大小写），或者包含任何函数、变量，或者相关表发生变化，都会导致缓存失效。官方并不推荐使用查询缓存，并会在后续版本中移除该功能</p>
<h2 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h2><p>本质上来说存储引擎的功能就是维护文件的读写，由于提供了标准API，mysql服务层可以方便切换不同的存储引擎，以适应不同场景</p>
<p><strong>myisam与InnoDB比较</strong><br>mysql有多种存储引擎，常用的是InnoDB和MyISAM，最新版本默认存储引擎为InnoDB，关于两者的区别主要是</p>
<ul>
<li>锁，InnoDB支持行锁、表锁，myisam支持表锁</li>
<li>事务，InnoDB支持事务，myisam不支持</li>
<li>索引<ul>
<li>InnoDB支持外键，myisam不支持</li>
<li>InnoDB数据与索引组织在一块（聚簇索引），myisam数据与索引分离，且可以压缩，内存中可以加载更多索引</li>
<li>myisam支持空间索引、全文索引，InnoDB则需要5.6以上版本</li>
<li>myisam允许表中不设置主键，InnoDB如果未显式设置主键则会自动选择非null唯一索引作为主键，无则自动创建不可见的6字节rowid作为主键</li>
</ul>
</li>
<li>大小，myisam整体文件要小一些</li>
<li>安全，InnoDB崩溃后可以自动修复数据</li>
<li>读写性能，myisam写性能高于InnoDB，但高并发情况下差别不大；两者读性能无明显差异</li>
</ul>
<p><strong>存储引擎选择</strong><br>经过长期优化，InnoDB的读性能并不弱于myisam，全文索引、空间索引也主键支持，而且在安全性、维护性方面也更加优秀。除非是特殊场景，如内存表、分布式、数据归档等可以针对性选择适应的存储引擎，<code>大部分时候使用InnoDB就可以了</code></p>
<h2 id="表结构"><a href="#表结构" class="headerlink" title="表结构"></a>表结构</h2><h3 id="整数"><a href="#整数" class="headerlink" title="整数"></a>整数</h3><table>
<thead>
<tr>
<th>schema</th>
<th>byte</th>
<th>bit</th>
<th>min ~ max</th>
<th>min ~ max unsigned</th>
</tr>
</thead>
<tbody>
<tr>
<td>tinyint</td>
<td>1</td>
<td>8</td>
<td>-128~127</td>
<td>0~255</td>
</tr>
<tr>
<td>smallint</td>
<td>2</td>
<td>16</td>
<td>-32768~32767</td>
<td>0~65535</td>
</tr>
<tr>
<td>mediumint</td>
<td>3</td>
<td>24</td>
<td>-8388608~8388607</td>
<td>0~16777215</td>
</tr>
<tr>
<td>int</td>
<td>4</td>
<td>32</td>
<td>-2147483648~2147483647</td>
<td>0~4294967295</td>
</tr>
<tr>
<td>bigint</td>
<td>8</td>
<td>64</td>
<td>-92…(19位)~92…(19位)</td>
<td>0~18…(20位)</td>
</tr>
</tbody>
</table>
<p>整数的表示范围为-2^(N-1) ~ 2^(N-1)-1，如果为无符号整数（unsigned）则0 ~ 2^(N)-1</p>
<p><strong>int(1) int(11)区别</strong><br>不会影响存储空间和存储范围, 只是规定了mysql的一些交互工具用来显示字符的个数</p>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><ul>
<li>char 定长字符串</li>
<li>varchar 变长字符串</li>
<li>text 长文本</li>
</ul>
<p><strong>字节长度</strong><br>char(8) varchar(8)都表示8个字符, 跟编码无关。varchar实际占用字节计算方式为：<code>varchar长度 * 编码字节 + 长度记录 + null标志（如果允许null的话）</code>，varchar中记录长度的字节在小于255为1, 大于255为2。而char则会自动补空格或者截断</p>
<p>varchar最大字节为65535，即当采用latin编码时最多存65533个字符, utf8时则为2万多。char上限为255字节，text同样为65535，其实当varchar长度大于500时，系统会隐式转换为text</p>
<p>text同族tinytext为256Byte，mediumtext为16MB，longtext为4GB</p>
<p><strong>字符集</strong><br>不同的字符集表示的字符数量和占用字节都不同。比如常用的utf8可以表示所有字符，占用大小为1~4字节，其中常用的为1~3字节，<code>坑爹的是mysql中utf8是utf8mb3的别名，即1~3字节，utf8mb4才是1~4字节，如表情</code></p>
<p><strong>字符比较规则 collation</strong><br>utf8_general_ci是一种通用的比较规则，_ci表示不区分大小写</p>
<h3 id="时间"><a href="#时间" class="headerlink" title="时间"></a>时间</h3><p>mysql中提供了多种时间类型, year date time datetime timestamp等</p>
<p><strong>datetime</strong><br>表示范围1001年到9999年</p>
<p><strong>timestamp</strong><br>表示范围 1970年1月1日(格林尼治标准时间)至 2038年<br>mysql提供了<code>from_unixtime()</code>把时间戳转换日期, 和<code>unix_timestamp()</code>转换日期为时间戳<br>可以设置插入或更新数据时的行为<br>默认情况下尽量使用timestamp, 如果需要处理毫秒级数据可以使用bigint进行hack</p>
<h3 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h3><p>enum（枚举）和set（集合）数据类型并不常用，虽然在恰当的场景可以提高性能，但由于数据调整时需要进行DDL成本较高，而且在排序时容易产生疑惑，所以一般使用char进行替代</p>
<h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><p>mysql最核心的作用就是提供SQL交互，即增删改查，本小节主要总结mysql的SQL用法，性能优化问题会单独总结，因为我觉得先会跑，再求快。而且很多SQL的用法本身并没问题，所谓的“优化”只是mysql目前还不够聪明导致的，可能在后续迭代中自然而然的消失，所以我觉得SQL使用和优化最后还是分开好一些</p>
<h3 id="count"><a href="#count" class="headerlink" title="count"></a>count</h3><ol>
<li><strong>count(col)</strong> 统计某个列<code>值不为null</code>的行数</li>
<li><strong>count(express)</strong> 统计表达式<code>值不为null</code>的行数</li>
<li><strong>count(*)</strong> 统计查询结果集行数</li>
</ol>
<p>曾经有一些广为流传的“神话”，比如count(col)这样指定具体某一列的性能要好于count(*)、myisam的count非常快</p>
<p>其实count(*)会直接明确的统计行数，指定一个列反而需要会慢一些（可能需要检测null等）。而myisam只记录了全表的行数，所以count只要包含查询条件，速度与其他存储引擎差别并不大</p>
<h3 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h3><p>distinct的作用是对结果集去重，只能用在列首，作用于所有列，也可以与count一起使用（count(disctinc col)）</p>
<p><code>select disctinct col1, col2 where id &gt; 123</code></p>
<h3 id="group-by"><a href="#group-by" class="headerlink" title="group by"></a>group by</h3><p>group by的作用是对结果集进行聚合，经常与聚合函数count min max sum avg group_concat、聚合结果过滤having一起使用</p>
<p><strong>SQL的执行顺序</strong><br>理解group先要理解SQL的执行顺序，<code>from &gt; where &gt; group（含聚合）&gt; having &gt; order &gt; limit &gt; select</code>，即先确定查询的表，再筛选结果集，再执行聚合，再having过滤聚合结果，最后order排序。明白这个，几个易错地方就很好理解了</p>
<ul>
<li>聚合函数min max等只是作用于分组内</li>
<li>由于where执行在聚合函数前，所以where条件不能包含诸如count(*)&gt;1，having、order则可以</li>
<li>order的排序并不影响聚合，而是对聚合结果的排序，<code>所以想通过使用order影响聚合首行行不通，聚合的首行其实是物理存储的首行</code></li>
<li>select最后才执行，<code>所以想通过min、max来影响聚合首行也是行不通的</code></li>
</ul>
<p>group_concat可以获取聚合中的某一列所有结果的拼接，个别场景非常好用</p>
<h3 id="union"><a href="#union" class="headerlink" title="union"></a>union</h3><p>union的作用是将多个查询的结果合并，要求查询的列名、列数要一致。默认会进行去重，导致filesort，除非明确需要, 否则最好使用<code>Union All</code></p>
<p>另一个易错的地方是使用union时limit并不是针对union后的结果集，而是单个查询</p>
<h3 id="join"><a href="#join" class="headerlink" title="join"></a>join</h3><p>表连接查询是常用操作，简单说就是两个表求笛卡尔积，然后按where条件过滤（当然，真实情况mysql不会真的先求笛卡尔积，而是边连接边过滤，尽可能少的扫描数据）。连接分为内连接和外连接，使用关键字<code>on</code>来限定连接条件</p>
<p><strong>内连接</strong><br>内连接指当连接生成的行不满足连接条件时，过滤该行，所以内连接中on与where的效果一样，以下是内连接语法</p>
<ul>
<li>select * from t1, t2</li>
<li>select * from t1 inner join t2</li>
<li>select * from t1 cross join t2</li>
</ul>
<p><strong>外连接</strong><br>外连接指当连接生成的行不满足连接条件时，只保留驱动表，被连接表的字段为null。分为左外连接和右外连接</p>
<ul>
<li>select * from t1 left join t2</li>
<li>select * from t1 right join t2</li>
</ul>
<p><strong>优化</strong><br>连接查询可以依次连接多个表，最多61个，不过建议不要超过12个，而且最好使用小表驱动大表，连接列最好有索引</p>
<h2 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h2><p>索引的目的为加速查询，用好mysql的一个难点就是针对业务场景设计高效的索引。索引类型有很多种哈希索引、BTree索引、全文索引、空间索引，本小节直接以最常用的BTree索引为例说明</p>
<h3 id="索引数据结构"><a href="#索引数据结构" class="headerlink" title="索引数据结构"></a>索引数据结构</h3><p><strong>B+Tree</strong></p>
<p><img src="http://ww1.sinaimg.cn/large/006QGE4bly1gevhglmi32j30f305bmx8.jpg" alt="索引B+Tree.png"></p>
<p>如图所示，多数数据库索引使用的数据结构是B+Tree</p>
<ul>
<li>叶子节点存储着key和data，以及下一个叶子节点</li>
<li>非叶子节点分为多层帮助key逐级定位</li>
</ul>
<p>这是一个非常抽象的示意图，不过已经可以揭示索引本质，帮助理解许多索引的使用和优化了。但如果要更深入的理解mysql查询执行原理和优化，就需要大致了解索引的真实物理结构，如下图所示</p>
<p><img src="http://ww1.sinaimg.cn/large/006QGE4bly1gevhxhpxe4j31ak0ow4qp.jpg" alt="索引B+Tree物理结构.png"></p>
<ul>
<li>数据是维护在以页为单位的数据结构中</li>
<li>页分为多种，这里能看到存储节点的目录项记录页，和存储叶子节点的用户记录页</li>
<li>每个页中数据是一个有序单链表，页间是一个有序的双链表</li>
<li>页中记录了每个页中节点的最大、最小值，方便检索</li>
</ul>
<p>那么一次真实索引查询的大概过程就是</p>
<ol>
<li>在目录项记录页中依次检查每个页的最大值和最小值，判断数据是否在该页中，若不在则链表找下一页</li>
<li>逐层定位到数据所在的用户记录页</li>
<li>定位到用户记录页后，遍历页中单链表，根据主键找到数据节点</li>
</ol>
<p><strong>为什么不使用二叉树、红黑树、B-Tree</strong></p>
<ul>
<li>树的高度决定查询需要的随机IO次数</li>
<li>二叉树出度为2，会导致树的高度过大，增加顺序IO次数，降低性能；而且二叉树容易出现不平衡，导致平均查询性能下降</li>
<li>红黑树虽然平衡，但出度依旧为2</li>
<li>B-Tree是data保存在内部节点，这就导致页存储的内部节点数量减少，单页能够维护的出度变小，树高增加</li>
</ul>
<p><strong>为什么以页为基本单位？</strong><br>这主要是目前计算机硬盘物理特性决定的，系统每次加载数据最少要读取一个页，而且随机IO的性能要比顺序IO差两个数量级，所以mysql巧妙的以页为单位维护数据，尽可能提高IO性能</p>
<p><strong>索引的优点</strong></p>
<ul>
<li>由于目录项页不存实际数据，所以记录数量非常大，一般情况树的深度不会超过4，也就是一次查询最多需要4次随机IO</li>
<li>对于范围查询，只需要确定上下边界，顺序IO即可</li>
<li>因为索引中数据是有序的，所以order、group都可以利用索引，指数级降低耗时</li>
</ul>
<h3 id="索引相关概念"><a href="#索引相关概念" class="headerlink" title="索引相关概念"></a>索引相关概念</h3><p><strong>聚簇索引</strong><br>即数据和索引存储在一起，InnoDB的数据表本身就是一个聚簇索引，所以它也只能有一个聚簇索引。优点是找到索引就找到了数据，不需要回表</p>
<p>缺点是</p>
<ul>
<li>假如能够将所有数据放入内存中, 则聚簇索引便无意义了, 因其提供的I/O优势不存在</li>
<li>插入速度严重依赖插入顺序，无序插入的话会频繁导致裂页操作</li>
<li>更新代价高，可能导致数据在页中交换</li>
<li>由此导致产生的二级索引会比想象的大, 因为其必须包含主键索引</li>
<li>二级索引查找需要两次索引查找, 因为二级索引中保存的是主键而不是数据</li>
</ul>
<p><strong>主键索引、一级索引、二级索引</strong><br>主键索引也叫一级索引，在InnoDB中就是聚簇索引，二级索引指非主键索引，他们同样也是B+Tree数据结构，不同的是叶子节点中存的是主键key，而不是实际数据，定位数据后需要多一次<code>回表</code>即到聚簇索引中查询</p>
<p>回表需要随机IO，性能较差，如果二级索引需要回表的量过大的话，可能导致mysql认为全表扫描成本更低</p>
<p><strong>前缀索引</strong><br>索引列为字符串时，可以设置索引列的长度，用来平衡索引选择性和索引大小。比如加入索引一个uuid，其实只需要设置字符串的前6位就能获取较好的选择性，没必要把全部列纳入索引</p>
<p>前缀索引虽然可以减小索引长度，放入更多索引至内存。但会导致不能使用索引进行order by和group by，无法使用覆盖索引</p>
<p>前缀索引长度的选择需要考虑索引选择性, 选择性很差还不如不使用。试探索引选择性:<br><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT</span><br><span class="line">mysql&gt; count(distinct left(city,<span class="number">3</span>))/count(*) as sel3,</span><br><span class="line">mysql&gt; count(distinct left(city,<span class="number">4</span>))/count(*) as sel4,</span><br><span class="line">mysql&gt; count(distinct left(city,<span class="number">5</span>))/count(*) as sel5</span><br><span class="line">mysql&gt; FROM table;</span><br></pre></td></tr></table></figure></p>
<p><strong>覆盖索引</strong><br>覆盖索引指索引列包含了查找的全部列，包括where条件和select的列</p>
<p><strong>联合索引</strong><br>联合索引就是多列索引</p>
<p><strong>三星索引</strong></p>
<ol>
<li>索引将相关的记录放到一起则获得一星</li>
<li>索引中的定义顺序和查找中的排序顺序一致则获得二星</li>
<li>索引中列包含了查询中需要的全部列则获得三星</li>
</ol>
<h3 id="MyISAM索引比较"><a href="#MyISAM索引比较" class="headerlink" title="MyISAM索引比较"></a>MyISAM索引比较</h3><p>myisam中索引与数据是分开存储的，即主键索引、二级索引叶子节点中存放的都是实际数据地址，而不是实际数据</p>
<p><img src="http://ww1.sinaimg.cn/large/006QGE4bly1gevkjaiqmhj30ig0eujs1.jpg" alt="myisam索引.png"></p>
<h2 id="事务、锁"><a href="#事务、锁" class="headerlink" title="事务、锁"></a>事务、锁</h2><h3 id="事务基本概念"><a href="#事务基本概念" class="headerlink" title="事务基本概念"></a>事务基本概念</h3><p><strong>ACID</strong><br>事务要满足ACID四个特性</p>
<ul>
<li>原子性 (atomicity)</li>
<li>一致性 (consistency)，事务结束后数据库依然保持约束的一致性，如唯一索引不能重复</li>
<li>隔离性 (isolation)，事务之间要相互隔离</li>
<li>持久性 (durability)，事务执行结束后就永久保存，不会丢失</li>
</ul>
<p><strong>保存点</strong><br>对于一个长事务，可以不断设置保存点，防止回滚导致成本太大。由于mysql不支持事务嵌套，一般也通过保存点来模拟事务嵌套</p>
<p><strong>语法</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">BEGIN / START TRANSACTION</span><br><span class="line">update...</span><br><span class="line">insert...</span><br><span class="line"></span><br><span class="line">SAVEPOINT save_fin_1</span><br><span class="line">update...</span><br><span class="line"></span><br><span class="line">ROLLBACK TO save_fin_1 # 回退</span><br><span class="line"></span><br><span class="line">update...</span><br><span class="line">SAVEPOINT save_fin_2</span><br><span class="line">RELEASE SAVEPOINT save_fin_2 # 删除</span><br><span class="line"></span><br><span class="line">COMMIT / ROLLBACK</span><br></pre></td></tr></table></figure></p>
<p><strong>自动提交</strong><br>本来不想写这段，但看到各种事务相关的文章里都人云亦云的加一个所谓的<code>关闭自动提交</code>，就忍不住提一下。autocommit=ON的意思是每一条语句都是一个独立事务，包括增删改查，显式开启事务后自动关闭</p>
<p><strong>隐式提交</strong><br>mysql中一些操作会导致当前事务隐式提交</p>
<ul>
<li>事务中再开启事务</li>
<li>执行DDL</li>
<li>加载数据，如LOAD DATA</li>
<li>主从操作</li>
</ul>
<p><strong>redo日志</strong><br>要实现事务的持久性，则要在事务提交之前，现将数据写入硬盘。mysql为了提高IO性能，数据库的写操作会先写入内存中的数据页，再异步刷新到硬盘。这样每当事务提交，相关的页就需要刷新到硬盘，写性能压力会非常大，redo日志便是为了解决该问题</p>
<p>其实不需要把整个页刷新，只需要把该页的位级别diff刷新到硬盘即可，这就是redo日志。redo日志很小，大约几mb，一直循环覆盖顺序写入，每当事务提交就刷新内存中的redo脏页到硬盘的redo日志，每当表的脏页刷新到硬盘中时，redo中对应的事务部分就标记为可以覆盖</p>
<p><strong>undo日志</strong><br>undo日志与redo日志类似，不过是为了实现事务的回滚，每当事务产生一条更新，undo日志就会记录一个对应的撤销sql</p>
<h3 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h3><p>锁是实现并发写，和事务隔离的重要机制</p>
<h4 id="锁分类"><a href="#锁分类" class="headerlink" title="锁分类"></a>锁分类</h4><p><strong>行锁、表锁</strong><br>锁按照锁粒度可以分为表级锁和行级锁（还有个页级锁），表锁实现在mysql服务层，与存储引擎无关；行锁实现在存储引擎层，不同存储引擎的支持、实现都有所不同。粒度越小开销越大，并发性越好，出现死锁的概率也越大</p>
<p>横向按照排他性可划分为读锁（共享锁）和写锁（排他锁），写锁的优先级更高，在锁等待队列中可以插队</p>
<p><strong>行锁实现</strong><br>行锁按照实现算法，又可以分为</p>
<ul>
<li>record lock 记录锁</li>
<li>gap lock 间隙锁</li>
<li>next-key lock 记录锁+间隙锁</li>
</ul>
<p>简而言之，记录锁只会锁住记录本身；间隙锁则锁住两个记录的间隙，唯一作用就是防止幻读（mvcc也可解决幻读）；next-key lock则是锁住记录本身以及<code>其前紧挨的间隙</code>。为了覆盖所有间隙，mysql有两个特殊的隐藏记录分别为最大和最小，用于实现表中最大值之后与最小值之前的间隙</p>
<p><strong>意向锁</strong><br>这个知道就好，一般用不到。<code>意向锁属于表锁</code>，作用是为了兼容行锁与表锁，试想一千万行记录中有一个行写锁，这时候要加表锁难道要先遍历检查每行是否有写锁？不是的，在加行锁的时候就加了对应的表级意向写/读锁，这样就可以快速判断是否可以加表锁</p>
<p>另外间隙锁实现阻塞插入是通过<code>插入意向锁</code>，insert之前要先获取间隙的插入意向锁，而其与间隙锁互斥。插入意向锁之间并不互斥</p>
<p><strong>悲观锁、乐观锁</strong><br>悲观锁、乐观锁属于加锁策略，悲观锁思想为写冲突会有很多，所以要对操作对象加排他锁；乐观锁则认为写冲突并不多，所以通过更新条件来实现软性的写锁，比如常用update…where version=3，并不加写锁，更新失败则知道出现冲突。需要根据实际业务场景来确定到底使用哪种策略才可以最大化系统并发</p>
<h4 id="加锁"><a href="#加锁" class="headerlink" title="加锁"></a>加锁</h4><p><strong>显式加锁</strong><br>可以显式的加表锁和行锁（读锁与写锁），其中行锁必须在一个事务中，而且行锁的具体算法根据存储引擎、事务隔离级别自动选择<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lock table tab_name read|write</span><br><span class="line">flush tables with read|write lock # 全局表加锁</span><br><span class="line">unlock tables</span><br><span class="line"></span><br><span class="line">begin</span><br><span class="line">select * from table where ... for update</span><br><span class="line">select * from table where ... lock in share mode</span><br><span class="line">commit / rollback</span><br></pre></td></tr></table></figure></p>
<p><strong>隐式加锁</strong><br>DDL语句都会导致表锁；任何的delete、update都会自动添加写锁；可串行隔离级别的事务中会自动加读锁</p>
<p><strong>锁升级</strong><br>由于InnoDB的行锁是实现在索引上的，假如行锁没有索引，或者索引选择性差导致加锁过多时，有可能会导致行锁升级为表锁。其实是mysql认为使用表锁cost更小，对使用者透明，不过出现这种现象往往意味着sql设计存在缺陷，需要优化</p>
<h4 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h4><p>死锁指两个事务互相等待对方释放所需资源的锁, 导致事务阻塞。解决办法一般有</p>
<ul>
<li>回滚其中一个事务（可能只需回滚到上个savepoint，而非全部回滚）</li>
<li>对资源加锁的按照相同顺序</li>
<li>悲观锁策略, 事先对可能用到的资源全部加锁</li>
</ul>
<h3 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h3><p>由于事务可以回滚，如果不进行适当隔离，回滚的数据就有可能造成错误。由于隔离主要通过锁实现，隔离越严格则并发性就越差，但出问题的概率就越小，我们需要根据实际业务场景设置mysql的隔离级别。标准的隔离级别分为4层，mysql全部支持，默认为可重复读</p>
<ol>
<li>未提交读，read uncommitted。允许事务读到其他事务未提交的修改</li>
<li>已提交读，read committed。只允许事务读取其他事务已提交的修改</li>
<li>可重复读，repeatable read。保证事务相同的读取得到的结果是一致的</li>
<li>可串行化，serializable。事务串行执行，虽然部分读还可以并行，但并发性降至最低</li>
</ol>
<p>未提交读相当于基本没有隔离，读到其他事务未提交的修改叫做<code>脏读</code>，如果发生回滚则极易出错。通过MVCC和加读锁，已提交读可以避免脏读，但由于该隔离级别允许读到已提交的修改，所以会出现相同的查询，前后读取结果不同的情况，叫做<code>不可重复读</code>（其中由于insert导致读取结果变多的特殊情况叫做<code>幻读</code>）。可重复读级别利用MVCC实现了可重复读，而且在标准允许出现幻读的情况下，超前在该级别解决了<code>幻读</code>。最高级别的可串行化通过默认为所有读加读锁，来解决之前所说的问题，但依然存在事务先后提交而导致的逻辑错误的可能</p>
<p><strong>MVCC</strong><br>多版本并发控制。mysql为每一条记录维护了一个链表，记录了当前活跃事务对其进行的修改历史链表。嗯，知道这么多就能够理解许多问题了</p>
<p><strong>非锁定一致性读</strong><br>update、delete会默认加写锁，而select除非明确加锁，或者可串行隔离级别，默认是无锁读的。实现隔离级别并非完全依赖锁，利用MVCC便可以实现非锁定一致性读，如RC级别通过读取MVCC中的最新已提交版本实现已提交读，RR级别通过管理先后关系控制事务读取版本从而实现可重复读。由于不需要加锁，mysql的并发性得到保障</p>
<p><strong>可重复读</strong><br>该隔离级别在SQL标准中是允许出现幻读的，但mysql通过MVCC实现了可重复读，同时解决了幻读。但又不是彻底的解决了幻读，select式的幻读解决了，但insert导致的幻读却未被解决，如唯一索引插入相同数据，明明select没有该值，但却出现插入阻塞。这时需要明确加读行锁来解决，这主要是因为RR级别下，行锁的默认算法为next-key，可以锁定间隙</p>
<p>有时候RR级别也需要读已提交，此时可以通过加读锁来明确读取记录最新版本</p>
<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>优化的目的是减少查询时间，这个查询时间其实包括了查询请求发送、数据库查询、结果返回，通常情况主要时间消耗在数据库查询环节。所以优化的大原则是</p>
<ol>
<li>最好不需要查询，即通过缓存或产品改进，避免数据库查询</li>
<li>查询执行的越快越好，涉及的方面比较多<ol>
<li>列尽量少、结构尽量简单，内存加载的更多、扫描更快</li>
<li>查询尽可能利用索引，减少扫描的行数、避免排序、避免回表</li>
<li>结果集尽量精简行数和列</li>
<li>避免大事务、大批量、大SQL</li>
</ol>
</li>
</ol>
<p>优化的主要思路是结合业务实际需要，分析慢查询日志，对慢sql进行分类，再用explain分析，最后通过调整sql、表设计解决慢查询问题</p>
<h3 id="库表优化"><a href="#库表优化" class="headerlink" title="库表优化"></a>库表优化</h3><p><strong>表设计原则</strong></p>
<ul>
<li>平衡范式和冗余，适当的冗余和违反范式可以降低sql复杂度</li>
<li>单表列数最好小于20，行数控制在千万级别</li>
<li>尽量把大列分拆到子表中，需要时连接查询</li>
<li>更小的类型通常更好，满足需求的情况下尽量使用最小数据类型，不过也要考虑未来扩展维护</li>
<li>尽量使用简单的数据类型，如能用date就别用varchar、能用varchar就别用text</li>
<li>尽量使用not null定义列</li>
</ul>
<p><strong>varchar越小越好</strong><br>varchar(6) varchar(200)用于存储 hello 时的耗费是一致的, 那么使用短列有优势吗？<br>事实证明是有很大优势的，因为开辟内存时是以200字节进行的，遇到需要filesort或tmp table作业可能会带来不利影响</p>
<p><strong>InnoDB主键类型选择</strong><br>优先使用合适大小的自增整数类型</p>
<ul>
<li>合适大小可以减小空间, 加快计算速度</li>
<li>自增由于是顺序插入，可以尽可能的减少裂页，插入速度更快。假如使用md5为主键，由于散列均匀，会大量裂页</li>
<li>由于二级索引会包含主键，所以主键越小越好</li>
</ul>
<p><strong>enum</strong><br>虽然enum更简单更小，但由于维护成本较高，大多数情况都可以使用char来代替</p>
<p><strong>alter table</strong><br>mysql执行大部分DDL的方法都是创建一个新表，导入数据后，删除旧表，非常耗时、耗内存，要非常慎重</p>
<h3 id="索引设计"><a href="#索引设计" class="headerlink" title="索引设计"></a>索引设计</h3><p><strong>索引设计原则</strong></p>
<ul>
<li>尽量使用选择性高的列</li>
<li>索引并非越多越好，尽量扩展索引，而非新增，使用联合索引来减少索引数量</li>
</ul>
<h3 id="查询优化"><a href="#查询优化" class="headerlink" title="查询优化"></a>查询优化</h3><p><strong>查询优化原则</strong></p>
<ul>
<li>sql尽量精简，拒绝大事务、大批量、大SQL，复杂的sql需求要进行拆分</li>
<li>避免mysql承担过多计算任务</li>
</ul>
<p><strong>查询成本估算</strong><br>一个查询可能有多种执行方案，mysql会计算每个方案的cost（成本）然后选择成本最低的。因为实时性要求高，这个cost只是估算，比如加载一个页耗时1.0，读取并检测一条记录耗时0.2，再根据mysql的统计数据与执行计划，便能大概估算个cost。所以有时候即便有索引可用，mysql也可能认为全表扫描综合成本更低</p>
<p>当然有时候这个估算也会出错，此时需要明确指定执行计划，如force index</p>
<p><strong>不能使用索引的场景</strong></p>
<ul>
<li>不是按照索引的最左列开始查找</li>
<li>不能跳过索引中的列</li>
<li>如果查询中的某个列是范围查询, 则其右边的所有列都无法使用索引，比如like between</li>
<li>索引列上使用函数, 或者算数运算</li>
<li>少用or</li>
<li>列类型是字符串的话，查询时一定要给值加引号，否则索引失效</li>
<li>表连接时列字符集不同</li>
</ul>
<p><strong>select</strong><br>尽量少使用select *，不仅是因为对索引不友好，还因为查出不需要的数据会侵占宝贵的缓存资源，导致缓存频繁变化，命中率下降</p>
<p><strong>where</strong></p>
<ol>
<li>直接在做索引中使用where条件来过滤，存储引擎层便可以完成，最为高效</li>
<li>假如无法使用索引筛选数据，如`col like ‘%a’，但若col列在索引中，则可以通过全量扫描索引过滤数据</li>
<li>使用了索引中没有的列为过滤条件，则需要把数据读出到服务层进行扫描过滤</li>
</ol>
<p><strong>order</strong><br>避免使用order by rand()<br>尽量使用升序</p>
<p><strong>limit</strong><br>limit一个常见问题是大表的分页，由于limit在服务层进行，所以要把结果集全部查出来，再扫描获取所需结果，性能慢在大量的回表，所以解决思路有</p>
<ol>
<li>保证查询为覆盖索引，从而避免回表</li>
<li>假如无法满足覆盖索引，则先使用某列如主键通过覆盖索引确定结果集起始点，再通过范围查询获取结果</li>
</ol>
<p>延伸</p>
<ul>
<li><a href="https://www.jianshu.com/p/f8d81df7ab28" target="_blank" rel="external">mysql使用limit分页优化方案</a></li>
</ul>
<p><strong>join</strong><br>小表驱动大表</p>
<h3 id="explain"><a href="#explain" class="headerlink" title="explain"></a>explain</h3><p>优化之前先要确定sql的执行计划，explain中常用字段的含义为</p>
<ul>
<li>id 包括子查询在内每个查询的唯一id</li>
<li>type 针对单表的<code>访问方法</code></li>
<li>possible_keys 可能用到的索引</li>
<li>key 实际使用的索引</li>
<li>key_len <code>实际使用</code>的索引长度</li>
<li>ref 表连接方式</li>
<li>rows <code>预估</code>的扫描行数</li>
<li>extra 额外补充信息</li>
</ul>
<p><strong>type</strong><br>单表的访问方法，表明mysql如何从单表获取数据</p>
<ul>
<li><strong>system</strong> 表中只有一行数据或者是空表，只能用于myisam和memory表，Innodb引擎是all或者index</li>
<li><strong>const</strong> 基于主键或者非null唯一索引扫描, 结果最多返回一条数据</li>
<li><strong>eq_ref</strong> 表连接时，基于主键或者唯一索引扫描</li>
<li><strong>ref</strong> 普通索引扫描</li>
<li><strong>fulltext</strong> 全文检索</li>
<li><strong>index_merge</strong> 可以利用index merge特性用到多个索引，提高查询效率</li>
<li><strong>range</strong> 索引范围扫描</li>
<li><strong>index</strong> 全索引扫描，即可以通过索引扫描完成数据读取和过滤，<code>避免回表</code></li>
<li><strong>All</strong> 全表扫描</li>
</ul>
<p><strong>extra</strong></p>
<ul>
<li><strong>Using index</strong> 覆盖索引，不需要回表</li>
<li><strong>Using index condition</strong> 使用了索引进行结果过滤</li>
<li><strong>Using where</strong> 使用了where进行结果过滤，<code>也即在服务层完成</code></li>
<li><strong>Using filesort</strong> 在服务层进行了排序操作，尽量避免</li>
<li><strong>Using temporary</strong> 创建了临时表</li>
</ul>
<p><strong>key_len</strong><br>这个要特别注意，能帮助我们了解联合索引中有多少个列被实际使用到。列长度大概计算方法见1.4小节</p>
<p>延伸</p>
<ul>
<li>其他调试工具mysqldumpslow、show profile</li>
</ul>
<h2 id="运维管理"><a href="#运维管理" class="headerlink" title="运维管理"></a>运维管理</h2><h3 id="启动关闭"><a href="#启动关闭" class="headerlink" title="启动关闭"></a>启动关闭</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># mysql安装目录bin中有许多实用工具</span><br><span class="line"># mysqld，可启动mysql服务器进程，但并不常用</span><br><span class="line">mysqld</span><br><span class="line"></span><br><span class="line"># mysqld_safe，是一个脚本，调用了mysqld，但同时会启动一个监控进程，守护mysql进程</span><br><span class="line">mysqld_safe</span><br><span class="line"></span><br><span class="line"># mysql.server，也是一个脚本，调用了mysqld_safe，但可以添加参数进行管理。注意bin中的mysql.server默认为链接文件，源在support-files/mysql.server</span><br><span class="line">mysql.server stop</span><br><span class="line">mysql.server start</span><br><span class="line"></span><br><span class="line"># 如何开启/关闭mysql服务</span><br><span class="line">mysqladmin shutdown -uroot -p***</span><br><span class="line"></span><br><span class="line"># 如何登陆mysql数据库</span><br><span class="line">mysql -u username -p</span><br></pre></td></tr></table></figure>
<h3 id="配置管理"><a href="#配置管理" class="headerlink" title="配置管理"></a>配置管理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 查看配置文件位置</span><br><span class="line">mysql --help | grep cnf</span><br><span class="line"></span><br><span class="line">mysqld --verbose --help | grep -A 1 &apos;Default options&apos;</span><br><span class="line"># Default options are read from the following files in the given order:</span><br><span class="line"># /etc/mysql/my.cfn ~/.my.cnf /usr/etc/my.cnf</span><br></pre></td></tr></table></figure>
<p><strong>默认配置</strong><br>mysql可配置性太强也可以说是一个弱点, 其实大多数配置的默认值已经是最佳配置了, 所以最好不要改动太多。以下创建了一个完整的最小示例配置文件, 可以作为一个良好的起点, 不要以自带配置文件作为起点。此配置文件可能比你见过的其他配置文件太少了, 但实际上已经超过了许多人的需要, 请确保基本了解这些配置的意义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line"># General</span><br><span class="line">datadir                 = /var/lib/mysql</span><br><span class="line">socket                  = /var/lib/mysql/mysql.sock</span><br><span class="line">pid_file                = /var/lib/mysql/mysql.pid</span><br><span class="line">user                    = mysql</span><br><span class="line">port                    = 3306</span><br><span class="line">default_storage_engine  = InnoDB</span><br><span class="line"></span><br><span class="line"># InnoDB</span><br><span class="line">innodb_buffer_pool_size = &lt;value&gt;</span><br><span class="line">innodb_log_file_size    = &lt;value&gt;</span><br><span class="line">innodb_file_per_table   = 1</span><br><span class="line">innodb_flush_method     = 0_DIRECT</span><br><span class="line"></span><br><span class="line"># myisam</span><br><span class="line">key_bufffer_size        = &lt;value&gt;</span><br><span class="line"></span><br><span class="line"># Logging</span><br><span class="line">log_error               = /var/lib/mysql/mysql-error.log</span><br><span class="line">slow_query_log          = /var/lib/mysql/mysql-slow.log</span><br><span class="line"></span><br><span class="line"># Other</span><br><span class="line">tmp_table_size          = 32M</span><br><span class="line">max_heap_table_size     = 32M</span><br><span class="line">query_cache_type        = 0</span><br><span class="line">query_cache_size        = 0</span><br><span class="line">max_connections         = &lt;value&gt;</span><br><span class="line">thread_cache            = &lt;value&gt;</span><br><span class="line">table_cache             = &lt;value&gt;</span><br><span class="line">thread_cache            = &lt;value&gt;</span><br><span class="line">open_files_limit        = 65535</span><br><span class="line"></span><br><span class="line">[client]</span><br><span class="line">socket                  = /var/lib/mysql/mysql.sock</span><br><span class="line">port                    = 3306</span><br></pre></td></tr></table></figure></p>
<h3 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理"></a>用户管理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 查看系统用户</span><br><span class="line">select * from mysql.user;</span><br><span class="line"></span><br><span class="line"># 创建 &amp; 删除用户</span><br><span class="line">create user &apos;USERNAME&apos;@&apos;HOSTNAME&apos; identified by &apos;PASSWORD&apos;;</span><br><span class="line">drop user &apos;USERNAME&apos;@&apos;HOSTNAME&apos;;</span><br><span class="line"></span><br><span class="line"># 修改密码</span><br><span class="line">set password for &apos;USERNAME&apos;@&apos;HOSTNAME&apos; = password(&apos;NEW_PASSWD&apos;);</span><br><span class="line">set password = password(&apos;NEW_PASSWD&apos;); # 修改当前用户密码</span><br></pre></td></tr></table></figure>
<h3 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 模式： grant 权限 on 数据库对象 to 用户</span><br><span class="line"># 权限包括：</span><br><span class="line"># select delete update insert 增删改查, select(col1, col2) 限制到列</span><br><span class="line"># create drop alter 表管理权限</span><br><span class="line"># 注意：用户需要重新登录才能权限生效</span><br><span class="line"># FLUSH PRIVILEGES;</span><br><span class="line"></span><br><span class="line"># 查看权限</span><br><span class="line">show grants; # 查看当前用户</span><br><span class="line">show grants for &apos;USERNAME&apos;@&apos;HOSTNAME&apos;; # 查看指定用户</span><br><span class="line"></span><br><span class="line"># 授予全部权限</span><br><span class="line">grant all on DB.TABLE to &apos;USERNAME&apos;@&apos;HOSTNAME&apos;;</span><br><span class="line"></span><br><span class="line"># 允许用户再授权别人</span><br><span class="line">gran select on DB.TABLE to &apos;USERNAME&apos;@&apos;HOSTNAME&apos; with grant option;</span><br><span class="line"></span><br><span class="line"># 回收权限</span><br><span class="line"># 注意这里有个坑：revoke的权限要和grant的时候一样！ e.g.</span><br><span class="line"># grant all on *.* to user@&apos;%&apos;; 则必须</span><br><span class="line"># revoke all on *.* from user@&apos;%&apos;;</span><br><span class="line"># 所以需求如：100个表，其中97个授予delete权限，3个不给，不能简单的 grant delete on db.* .. 然后再revoke</span><br><span class="line">revoke 权限 on 数据库对象 from 用户</span><br></pre></td></tr></table></figure>
<h3 id="查看表信息"><a href="#查看表信息" class="headerlink" title="查看表信息"></a>查看表信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># 显示表格创建sql</span><br><span class="line">show create table table_name;</span><br><span class="line"></span><br><span class="line"># 简要列出表格的字段信息</span><br><span class="line">describe table_name;</span><br><span class="line"></span><br><span class="line"># 查看表大小</span><br><span class="line"># 进入information_schema 数据库（存放了其他的数据库的信息）</span><br><span class="line">use information_schema;</span><br><span class="line"></span><br><span class="line"># 查询所有数据的大小</span><br><span class="line">SELECT concat(round(sum(DATA_LENGTH/1024/1024),2),&apos;MB&apos;) as data FROM information_schema.TABLES;</span><br><span class="line"></span><br><span class="line"># 查看数据库所有表大小</span><br><span class="line">SELECT</span><br><span class="line">    table_name,</span><br><span class="line">    round(sum(DATA_LENGTH / 1024 / 1024) , 2) AS &apos;mb&apos;</span><br><span class="line">FROM</span><br><span class="line">    information_schema. TABLES</span><br><span class="line">WHERE</span><br><span class="line">    table_schema = &apos;lbsugc_ifix_before_2017_06_01&apos;</span><br><span class="line">group by table_name</span><br><span class="line">order by mb DESC;</span><br><span class="line"></span><br><span class="line"># 查看指定数据库的大小：比如查看数据库home的大小</span><br><span class="line">SELECT concat(round(sum(DATA_LENGTH/1024/1024),2),&apos;MB&apos;) as data FROM information_schema.TABLES WHERE table_schema=&apos;home&apos;;</span><br><span class="line"></span><br><span class="line"># 查看指定数据库的某个表的大小，比如查看数据库home中 members 表的大小</span><br><span class="line">SELECT concat(round(sum(DATA_LENGTH/1024/1024),2),&apos;MB&apos;) as data FROM information_schema.TABLES WHERE table_schema=&apos;home&apos; AND table_name=&apos;members&apos;;</span><br></pre></td></tr></table></figure>
<h3 id="查询管理"><a href="#查询管理" class="headerlink" title="查询管理"></a>查询管理</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 查看所有连接</span><br><span class="line"># mysql的查询可能处于的状态包括</span><br><span class="line"># Sleep 线程正在等待客户端发送新的请求</span><br><span class="line"># Query 线程正在执行查询或者正在将结果发送给客户端</span><br><span class="line"># Locked mysql服务器层, 该线程正在等待表锁(_存储引擎实现的锁并不会在此反映如行锁_). 对于myisam来说这是一个比较典型的状态, 但在其他没有行锁的引擎中也经常出现</span><br><span class="line"># Analyzing and statistics 线程正在收集存储引擎的统计信息, 并生成查询的执行计划</span><br><span class="line"># Copying to tmp table [on disk] 线程正在执行查询, 并且将结果集都复制到一个临时表中, 这种状态一般要么是在做group by操作, 要么是在file sort, 或者union;on disk标记表示mysql正在将一个内存临时表放到磁盘上</span><br><span class="line"># Sorting result 线程正在对结果集进行排序</span><br><span class="line"># Sending data 多种情况: 可能是线程在多个状态之间传送数据;或者生成结果;或者向客户端返回数据</span><br><span class="line">show full processlist</span><br><span class="line"></span><br><span class="line"># 关闭所有连接</span><br><span class="line">for i in $(mysql -uroot -p537ce49da46a -Bse &quot;show processlist&quot; | awk &apos;&#123;print $1&#125;&apos;);do mysql -uroot -p537ce49da46a -e &quot;kill $i&quot;;done</span><br></pre></td></tr></table></figure>
<h3 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 隔离级别设置</span><br><span class="line"># 查看隔离级别</span><br><span class="line">select @@tx_isolation</span><br><span class="line"># 设置读未提交级别</span><br><span class="line">set transaction isolation level read uncommitted</span><br><span class="line"># 设置读提交级别</span><br><span class="line">set transaction isolation level read committed</span><br><span class="line"># 设置可重复读（缺省），保证每次读的结果是一样的</span><br><span class="line">set transaction isolation level repeatable read</span><br><span class="line"># 设置成序列化</span><br><span class="line">set transaction isolation level serializable</span><br><span class="line"></span><br><span class="line"># 查看锁竞争统计</span><br><span class="line">show status like &apos;innodb_row_lock%&apos;;</span><br><span class="line">+-------------------------------+--------+</span><br><span class="line">| Variable_name                | Value  |</span><br><span class="line">+-------------------------------+--------+</span><br><span class="line">| Innodb_row_lock_current_waits | 0      |</span><br><span class="line">| Innodb_row_lock_time          | 150751 |</span><br><span class="line">| Innodb_row_lock_time_avg      | 21535  |</span><br><span class="line">| Innodb_row_lock_time_max      | 51158  |</span><br><span class="line">| Innodb_row_lock_waits        | 7      |</span><br><span class="line">+-------------------------------+--------+</span><br></pre></td></tr></table></figure>
<h3 id="导入、导出"><a href="#导入、导出" class="headerlink" title="导入、导出"></a>导入、导出</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 导出</span><br><span class="line">mysqldump -h$DB_HOST -Pprot -u$DB_USER -pPwd --skip-lock-tables -q \</span><br><span class="line">DB table1 table2 &gt; $DATA_PATH/itest.sql</span><br><span class="line"></span><br><span class="line"># -w 添加搜索条件</span><br><span class="line"></span><br><span class="line">mysqldump -h$DB_HOST -Pport -u$DB_USER -ppwd --skip-lock-tables -q \</span><br><span class="line">-w &quot;id &lt; 1000 and createTime&gt;unix_timestamp(&apos;20170101&apos;)&quot; \</span><br><span class="line">DB table1 table2 &gt; $DATA_PATH/itest.sql</span><br><span class="line"></span><br><span class="line"># -d 只导出表结构</span><br><span class="line"># -q 不缓冲查询，直接导出至stdout。（默认打开，用--skip-quick来关闭）该选项用于转储大的表</span><br><span class="line"># -t 只导出数据</span><br><span class="line"># -c 附带列名</span><br><span class="line"># --lock-all-tables 全局加读锁</span><br><span class="line"># --lock-tables 当前表加读锁</span><br><span class="line"># --add-locks 导入, sql文件时锁表</span><br><span class="line"># --skip-lock-tables 导出, 时不加读锁</span><br><span class="line"># --ignore-table=db_name.t2 排除表</span><br><span class="line">mysqldump -h$DB_HOST -Pport -u$DB_USER -pPwd --skip-lock-tables -q -d DB table &gt; $DATA_PATH/itest.sql</span><br></pre></td></tr></table></figure>
<p><strong>导入</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 导入 或者登陆mysql，使用source命令</span><br><span class="line">mysql -h... -P3306 -ulbsugc -p... lbsugc_hard &lt; taskCenter.sql</span><br></pre></td></tr></table></figure></p>
<p><strong>跨表导入数据</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSERT INTO SELECT</span><br><span class="line">-- 形式为：Insert into Table2(field1,field2,...) select value1,value2,... from Table1</span><br><span class="line">-- 要求目标表Table2必须存在，由于目标表Table2已经存在，所以我们除了插入源表Table1的字段外，</span><br><span class="line">-- 还可以插入常量</span><br><span class="line"></span><br><span class="line">SELECT INTO FROM</span><br><span class="line">-- 语句形式为：SELECT vale1, value2 into Table2 from Table1</span><br><span class="line">-- 要求目标表Table2不存在，因为在插入时会自动创建表Table2，</span><br><span class="line">-- 并将Table1中指定字段数据复制到Table2中</span><br></pre></td></tr></table></figure></p>
<h3 id="binlog"><a href="#binlog" class="headerlink" title="binlog"></a>binlog</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 查看binlog状态</span><br><span class="line">show variables like &apos;%log_bin%&apos;; # log_bin ON 开启</span><br><span class="line"></span><br><span class="line"># 开启binlog，编辑my.cnf，重启mysql</span><br><span class="line">server-id=1 # 随机设定的节点id</span><br><span class="line">log_bin=/home/lbsugc/.jumbo/var/lib/mysql/mysql-bin # binlog保存路径</span><br><span class="line">expire_logs_days=7 # binlog保留日期 0表示永不过期</span><br><span class="line"></span><br><span class="line"># 查看binlog文件</span><br><span class="line">show binary logs; # 查看当前服务器使用的全部binlog，每次重启服务器或者binlog文件过大，则分割新的</span><br><span class="line">show master status; # 当前mysql实例正在使用的binlog文件</span><br><span class="line">show binlog events in “mysql-bin.000005”; # 查看binlog内容</span><br><span class="line"></span><br><span class="line"># 使用mysqlbinlog工具</span><br><span class="line">mysqlbinlog mysql-bin.000005; # 查看binlog内容</span><br><span class="line">mysqlbinlog -d lbsugc_rocket mysql-bin.000005 -r out.sql # -d 指定db -r 指定输出文件</span><br><span class="line">mysqlbinlog mysql-bin.000005 --start-position=100 --stop-position=100 # 精确指定输出事件位置</span><br><span class="line">mysqlbinlog mysql-bin.000005 --start-datetime=&apos;2018-05-18 12:00&apos;--stop-datetime=&apos;2018-05-18 14:00&apos;# 指定输出事件起始时间</span><br><span class="line"></span><br><span class="line"># 使用binlog恢复数据</span><br><span class="line"># 原理很简单，mysqlbinlog输出的是sql文件，当做普通的.sql输入数据库即可</span><br><span class="line"># 比如在99号事件误删了数据库，则可这样恢复</span><br><span class="line">mysqlbinlog mysql-bin.000005 --stop-position=98 | mysql -uroot -p*** DB</span><br><span class="line">mysqlbinlog mysql-bin.000005 --start-position=100 --end-position=目标位置 | mysql -uroot -p*** DB</span><br></pre></td></tr></table></figure>
<h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 直接执行sql</span><br><span class="line">mysql -h10.57.27.37 -P5020 -uliu******* -pFb9F39SrpS lbsugc -e &quot;&quot;</span><br><span class="line"></span><br><span class="line"># 汉字拼音排序</span><br><span class="line">select poiName</span><br><span class="line">from userProblem</span><br><span class="line">order by convert(left(poiName,1) using gbk) desc;</span><br><span class="line"></span><br><span class="line"># 交换一个表中两列值</span><br><span class="line">update table a,table b set a.column1 = b.column2, a.column2=b.column1 where a.id=b.id;</span><br></pre></td></tr></table></figure>
<h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><h2 id="经典问题"><a href="#经典问题" class="headerlink" title="经典问题"></a>经典问题</h2><p><strong>mysql server has gone away 错误原因</strong></p>
<ul>
<li>mysql宕机</li>
<li>client连接时间过长</li>
<li>查询sql过大被断开</li>
<li>多进程场景，错误复用了连接，导致socket混淆</li>
</ul>
<h2 id="学习资料"><a href="#学习资料" class="headerlink" title="学习资料"></a>学习资料</h2><ul>
<li>掘金平台付费《MySQL是怎样运行的：从根儿上理解MySQL》</li>
<li>《MySQL技术内幕 InnoDB存储引擎》</li>
<li>《高性能MySQL》</li>
<li><a href="https://notes.diguage.com/mysql/?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io#_%25E5%2589%258D%25E8%25A8%2580" target="_blank" rel="external">MySQL学习笔记</a></li>
</ul>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>觉得有帮助的话, 请我喝杯茶吧</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wepay.jpg" alt="Liufxlucky365 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="Liufxlucky365 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/04/28/Git不权威总结/" rel="next" title="Git不权威总结">
                <i class="fa fa-chevron-left"></i> Git不权威总结
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC80NDE5Mi8yMDcyNQ=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/default_avatar.png"
                alt="Liufxlucky365" />
            
              <p class="site-author-name" itemprop="name">Liufxlucky365</p>
              <p class="site-description motion-element" itemprop="description">程序猿 IT php mysql 生活 秀恩爱</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">12</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#欢迎阅读"><span class="nav-text">欢迎阅读</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#架构"><span class="nav-text">架构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#存储引擎"><span class="nav-text">存储引擎</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表结构"><span class="nav-text">表结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#整数"><span class="nav-text">整数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#字符串"><span class="nav-text">字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#时间"><span class="nav-text">时间</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#枚举"><span class="nav-text">枚举</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SQL"><span class="nav-text">SQL</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#count"><span class="nav-text">count</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#distinct"><span class="nav-text">distinct</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#group-by"><span class="nav-text">group by</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#union"><span class="nav-text">union</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#join"><span class="nav-text">join</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#索引"><span class="nav-text">索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#索引数据结构"><span class="nav-text">索引数据结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#索引相关概念"><span class="nav-text">索引相关概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MyISAM索引比较"><span class="nav-text">MyISAM索引比较</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#事务、锁"><span class="nav-text">事务、锁</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#事务基本概念"><span class="nav-text">事务基本概念</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#锁"><span class="nav-text">锁</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#锁分类"><span class="nav-text">锁分类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#加锁"><span class="nav-text">加锁</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#死锁"><span class="nav-text">死锁</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事务隔离级别"><span class="nav-text">事务隔离级别</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优化"><span class="nav-text">优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#库表优化"><span class="nav-text">库表优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#索引设计"><span class="nav-text">索引设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询优化"><span class="nav-text">查询优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#explain"><span class="nav-text">explain</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#运维管理"><span class="nav-text">运维管理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#启动关闭"><span class="nav-text">启动关闭</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#配置管理"><span class="nav-text">配置管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#用户管理"><span class="nav-text">用户管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#权限管理"><span class="nav-text">权限管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看表信息"><span class="nav-text">查看表信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查询管理"><span class="nav-text">查询管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#事务"><span class="nav-text">事务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导入、导出"><span class="nav-text">导入、导出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#binlog"><span class="nav-text">binlog</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#常用命令"><span class="nav-text">常用命令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#集群"><span class="nav-text">集群</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#经典问题"><span class="nav-text">经典问题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#学习资料"><span class="nav-text">学习资料</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Liufxlucky365</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>


<div>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<span id="busuanzi_container_site_pv" style='display:none'>
    访问量 <span id="busuanzi_value_site_pv"></span>
    <span class="post-meta-divider">|</span>
</span>
<span id="busuanzi_container_site_uv" style='display:none'>
    <span id="busuanzi_value_site_uv"></span>人看过
</span>
</div>



        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  

  

  
  

  

  

  

</body>
</html>
